# Buffer和Cache的区别
- [Buffer和Cache的区别](#buffer和cache的区别)
  - [前言](#前言)
  - [Buffer的作用](#buffer的作用)
  - [Cache的作用](#cache的作用)
  - [注意事项](#注意事项)


## 前言
Buffer 和 Cache 是计算机系统中两种常见的数据存储机制。Buffer 用于临时存储数据以平衡数据传输速度；Cache 用于存储频繁访问的数据以提高访问速度。

## Buffer的作用
通常位于数据传输路径的两端，用于暂时存储数据，存储的是待处理或待传输的数据，即堆积一部分连续操作的数据，然后对堆积在一起的数据执行一次完整的读、写操作。

举例：

* 比如TCP套接字，它有两个buffer空间：send buffer和recv buffer。当它需要发送数据的时候，就会先把数据写到send buffer中缓冲一会，等达到了一定数量(或要求立即发送出去)后，就会把send buffer中的数据发送出去。发送出去就缓冲到了对方的recv buffer中，然后对方就会监控到它的recv buffer中有数据了，就会去读这个recv buffer。

Buffer之所以更高效，原因是N次读或写数据的成本高于一次完成大量数据读写的成本。

## Cache的作用
通常位于CPU和主存之间，用于存储频繁访问的数据，存储的是主存中的数据副本，是为了加速读的。

使用 Cache 的原因一般是两设备之间速度差太大，使得高速设备的资源被严重浪费。使用中间层 Cache，可以缓存一些可能被用上的数据，从而减少因速度差带来的低效和浪费。

举例：

* 比如CPU的高速缓存用来缓存一部分内存数据，可减小因CPU和内存之间速度差带来的CPU等待时间，CPU的L1、L2、L3都是因层次速度差而添加的。

* 再比如将数据库查询结果缓存在Redis中，使得客户端需要这部分数据时不用再从数据库这个低速层次去获取。


## 注意事项
因为Cache主要目的是为了完成加速读，但很多场景下Cache中也是可写的，这时Cache中的数据和主存中的数据可能不一致，即存在`缓存一致性`问题。所以对于支持缓存写操作的Cache层，需要考虑如何解决数据一致性问题，比如采取何种缓存写策略。

域缓存对应的概念是`持久化`，缓存数据易丢失，为了防止缓存中重要数据的丢失，可能需要将缓存数据持久化保存到持久存储设备中。

对于Buffer来说，需要考虑的是何时将数据发送出去的问题。例如何时去flush，是否要设置sync模式，以及flush、sync模式带来的低效问题。
