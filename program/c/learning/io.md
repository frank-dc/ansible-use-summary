# I/O 函数

## 简介
C 语言提供了一些函数，用于与外部设备通信，称为输入输出函数，简称 I/O 函数。

## 缓存和字节流
严格地说，输入输出函数并不是直接与外部设备通信，而是通过`缓存（buffer）`进行间接通信。

普通文件一般保存在磁盘上面，跟 CPU 相比，磁盘读取是一个很慢的操作，所以，程序直接读取磁盘是不可行的。C 语言的解决方案是，只要是打开一个文件，就在内存里面为这个文件设置一个缓存区。

程序向文件写入数据时，程序先把数据放入缓存区，等缓存区满了，再把缓存区数据一次性写入磁盘。这时，缓存区空了，程序再把新的数据写入缓存区，重复这个过程。

程序向文件读取数据时，文件先把一部分数据放入缓存区，然后程序从缓存区获取数据，等缓存区空了，磁盘再把新的数据放入缓存区，重复整个过程。

内存的读写速度要比磁盘快得多，缓存的设计减少了磁盘的读写次数，大大提高了程序的执行效率。另外，一次性移动大块数据，要比多次移动小块数据快得多。

这种读写模式，对于程序来说，有点像水流（stream），不是一次性读取或写入所有数据，而是一个持续不断的过程。先操作一部分数据，等到缓存吞吐完这部分数据，再操作下一部分数据。这个过程就叫做`字节流操作`。

由于缓存读完就空了，所以字节流读取都是只能一次，第二次就读不到了。

C 语言的输入输出函数，凡是涉及读写文件，都是属于字节流操作。输入函数从文件获取数据，操作的是`输入流`；输出函数向文件写入数据，操作的是`输出流`。

## 输出函数（写）
### printf()
将参数文本输出到文本，`f`代表`format`，表示可以定制输出文本的格式。行尾需要自行添加换行符`\n`。
```c
printf("hello world\n");
```
`printf()`可以在输出文本中指定占位符[^1]。

[^1]: 所谓'占位符'，就是这个位置可以用其它值代入。

常用的占位符可以参考[placeholder.md](placeholder.md)。

下面给出输出格式的一些例子。
* 限定宽度。
```c
printf("##%5d##\n", 123);   //输出 ##  123##
```
默认是右对齐，如果要左对齐
```c
printf("##%-5d##\n", 123);    //输出 ##123  ##
```
小数的默认显示精度是小数点后六位。
```c
printf("##%12f##\n", 123.45);   //输出 ##  123.450000##
```
* 总是显示正负号。
```c
printf("%+d\n", 123);   //输出 +123
```
* 限定小数位数。
```c
printf("%.2f\n", 0.5);  //输出 0.50
```
与限定宽度结合使用
```c
printf("##%6.2f##\n", 0.5); //输出 ##  0.50##
// 等同于
printf("##%*.*f##\n", 6, 2, 0.5);
```
* 输出部分字符串。
```c
printf("%.7s\n", "hello world");    //输出 hello w
```

### putchar()
`putchar()`函数将它的参数字符输出到屏幕。
```c
putchar(ch);
//等同于
printf("%c\n", ch);
```

### puts()
`puts()`函数用于将字符串显示在屏幕上，并自动在字符串末尾添加换行符。
```c
int	 puts(const char *);
```

## 输入函数（读）
### scanf()
用于读取用户的键盘输入。
```c
int main(void) {
    int x;
    float y;

    scanf("%d%f", &x, &y);
    // 用户输入 "    -13.45e12# 0"

    printf("%d\n", x);  //输出 -13
    printf("%f\n", y);  //输出 449999994880.000000
}
```
`scanf()`第一个参数是一个格式字符串，里面会放置占位符，告诉编译器如何解读用户的输入，需要提取的数据是什么类型。其余参数就是存放用户输入的变量，`格式字符串里面有多少个占位符，就有多少个变量`。

第二个参数必须加上`&`运算符，因为`scanf()`传递的不是值，而是地址。上述示例中，变量`x`和`y`的地址分别指向用户输入的值。

`scanf()`处理`数值占位符`时，会自动过滤空白字符，包括空格、制表符、换行符等。

`scanf()`返回值是一个整数，表示成功读取变量的个数，如果没有读取任何项，或者匹配失败，则返回`0`。如果读取到文件结尾，则返回常量`EOF`。

> 占位符

与`printf()`占位符基本一致，下面记录一些特别的占位符的使用。

* `%c`不会忽略空白字符，总是返回当前第一个字符，无论该字符是否为空格。如果要强制跳过字符前的空白字符，可以在`%c`前面加上一个空格，表示跳过零个或多个空白字符。
* `%s`的规则是，从当前第一个非空白字符开始读起，直到遇到空白字符为止。所以`%s`不会包含空白字符，不能用来读取多个单词，除非多个`%s`一起使用。另外，`scanf()`遇到`%s`占位符，会在字符串变量末尾存储一个空字符`\0`。

`scanf()`将字符串读入字符数组时，不会检测字符串是否超过了数组长度，很可能会超过数组的边界，为了防止这种情况，使用`%s`占位符时，应该指定读入字符串的最长长度。
```c
char name[11];
scanf("%10s", name);    // 表示最多读取用户输入的10个字符。
```

> 赋值忽略符

把`*`号放到占位符的百分号后面，该占位符就不会返回值，解析后将被丢弃。
```c
int year, month, day;
scanf("%d%*c%d%*c%d", &year, &month, &day);
```
以上示例，用户输入年月日之间任何分隔符都能被解析。

如果写成如下示例，用户输入2022/10/22，数据解析就会失败。
```c
scanf("%d-%d-%d", &year, &month, &day);
```

### sscanf()
`sscanf()`函数与`scanf()`类似，不同之处是`sscanf()`是从字符串里面获取数据。
```c
int sscanf(const char* s, const char* format, ...);
```
`sscanf()`主要用来处理其他输入函数读入的字符串，从其中提取数据。
```c
fgets(str, sizeof(str), stdin);
sscanf(str, "%d%d", &i, &j);
```

### getchar()
```c
int getchar(void);
```
`getchar()`函数返回用户从键盘输入的一个字符，不会忽略起首的空白字符。
```c
char ch;
ch = getchar();     //输入 ba
// 等同于
scanf("%c", &ch);

printf("%c\n", ch);     //输出 b
```

### gets()
`warning: this program uses gets(), which is unsafe.`

`gets()`函数用于从`stdin`读取整行输入，不会跳过起首的空白字符，直到遇到换行符为止。
```c
char	*gets(char *);
```
```c
char words[100];
puts("Plz enter a string: ");
gets(words);

printf("%s\n", words);
```

## 来源
* [https://wangdoc.com/clang/io.html](https://wangdoc.com/clang/io.html)