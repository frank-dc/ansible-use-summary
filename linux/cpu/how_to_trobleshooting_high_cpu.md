# 如何排查CPU持续飙高？
- [如何排查CPU持续飙高？](#如何排查cpu持续飙高)
  - [查看系统负载](#查看系统负载)
  - [查看进程占用](#查看进程占用)
  - [使用性能工具](#使用性能工具)
  - [其它排查事项](#其它排查事项)
    - [观察系统资源使用情况](#观察系统资源使用情况)
    - [检查定时任务](#检查定时任务)
    - [查看系统日志](#查看系统日志)
    - [查看内核模块](#查看内核模块)
    - [检查硬件问题](#检查硬件问题)


## 查看系统负载
使用`top`、`htop`、`uptime`命令查看当前系统负载情况，了解系统的整体运行状态。

## 查看进程占用
使用`top`、`htop`、`ps aux`命令查看是哪些进程占用了较多的CPU资源，有没有进程异常占用。
使用`top -H -p <pid>`命令可以查看线程占用CPU资源。

## 使用性能工具
样例：

`perf top -p <pid>`这个命令能够实时监控指定进程的性能状况，包括 CPU 使用情况、内存使用情况以及其他性能指标。它会按照 CPU 使用率高低对进程进行排序，并且显示每个进程所占用的 CPU 时间、调用的函数以及各种性能事件的统计信息。
```
perf record -e cpu-clock -g -p PID
perf report
```
这个命令将记录指定进程的 CPU 时钟事件，并生成报告，显示哪些函数调用消耗了大量的 CPU 时间。

`strace -p <pid>`这个命令将输出被跟踪进程的系统调用，可以观察程序在执行过程中调用了哪些系统函数，是否有异常行为。

## 其它排查事项
### 观察系统资源使用情况
使用 `sar` 或 `vmstat` 命令观察系统资源使用情况，包括 CPU、内存、磁盘和网络等方面，查看是否有异常。
  
### 检查定时任务
查看系统的定时任务（cron job），可能某些定时任务正在执行导致 CPU 使用率升高。

### 查看系统日志
检查系统日志文件，如 /var/log/messages、/var/log/syslog 等，查找是否有异常信息、错误或警告。

### 查看内核模块
有时候某个内核模块可能会引起 CPU 负载过高，检查加载的内核模块是否正常。

### 检查硬件问题
有时 CPU 高负载可能是由硬件问题引起的，如过热、散热不良等，检查硬件状态以排除问题。
